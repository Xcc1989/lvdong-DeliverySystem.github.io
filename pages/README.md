# 物流发货管理系统 - 页面说明文档

## 订单发货明细页面(orderList.html)

### 页面结构
1. **标题与操作按钮区**
   - 页面标题："订单发货明细"
   - API导入发货明细按钮
   - 本地导入发货明细按钮

2. **筛选区域**
   - 日期范围选择器（起始日期和结束日期）
   - 快递公司下拉筛选
   - 发货状态下拉筛选

3. **表格区域**
   - 表头包含所有列名和筛选按钮
   - 表格主体显示订单数据
   - 支持水平滚动查看所有列

4. **筛选标签区**
   - 显示当前激活的筛选条件
   - 可单独移除某个筛选条件
   - 可一键清除所有筛选条件

5. **分页区域**
   - 显示当前页码和总页数
   - 上一页/下一页按钮
   - 显示当前展示的记录范围和总记录数

### 数据结构
- **订单数据字段**：
  1. `orderTime`: 订单时间
  2. `orderNumber`: 订单号
  3. `weight`: 重量(kg)
  4. `address`: 地址
  5. `contact`: 联系人
  6. `phone`: 联系方式
  7. `expressCompany`: 快递公司
  8. `waybillNumber`: 物流单号
  9. `waybillTemplate`: 面单模板
  10. `shippingTime`: 寄件时间
  11. `logisticsStatus`: 物流状况(包含status和latestUpdate)
  12. `receivingTime`: 收件时间
  13. `isSigned`: 是否签收

### 数据流转
1. 页面加载时，先尝试从示例数据(orders-data.js)加载订单信息
2. 若示例数据不可用，则尝试从维格表API获取数据
3. 获取数据后应用当前筛选条件并显示
4. 用户可通过筛选和分页浏览订单数据
5. 用户可以为待发货订单选择快递公司并生成运单号
6. 生成运单号后，用户可选择面单模板并打印面单

### 注意事项
1. 表格支持水平滚动，确保在小屏幕设备上能查看所有列
2. 默认筛选范围为最近一个月的订单
3. 每页默认显示8条记录
4. 必须先选择快递公司才能生成运单号
5. 必须先生成运单号才能选择面单模板
6. 必须选择面单模板后才能打印面单
7. 导入功能需后端API支持，目前仅显示提示信息

## 物流动态看板页面(logisticsDashboard.html)

### 页面结构
1. **标题区域**
   - 页面标题："物流动态看板"
   
2. **日期选择区域**
   - 日期选择器
   - 月份选择器

3. **数据卡片区域**
   - 每日物流数据卡片
   - 月度物流数据卡片
   - 超时订单数据卡片

### 数据结构
- **每日物流数据**：
  1. 日期
  2. 发货数量
  3. 签收数量
  4. 退回数量
  5. 异常数量

- **月度物流数据**：
  1. 月份
  2. 总发货量
  3. 总签收量
  4. 签收率
  5. 平均配送时长

- **超时订单数据**：
  1. 超时订单数量
  2. 最长超时天数
  3. 平均超时天数
  4. 各快递公司超时占比

### 数据流转
1. 页面加载时，自动加载当前日期和当前月份的数据
2. 用户可选择不同日期或月份查看对应数据
3. 图表和摘要数据会随选择的日期/月份变化
4. 超时订单数据卡片中可查看所有超时订单

### 注意事项
1. 页面采用响应式设计，在不同设备上有良好显示效果
2. 图表使用Chart.js库绘制，支持交互和提示信息
3. 数据加载时显示加载指示器
4. 数据每5分钟自动刷新一次

## 物流对账明细页面(accountDetails.html)

### 页面结构
1. **标题与操作按钮区**
   - 页面标题："物流对账明细"
   - 导出Excel按钮
   - 生成月度报表按钮

2. **筛选区域**
   - 月份选择器
   - 快递公司下拉筛选
   - 是否已结算下拉筛选

3. **统计摘要区域**
   - 总订单数
   - 总金额
   - 已结算金额
   - 未结算金额

4. **表格区域**
   - 表头包含所有列名和筛选按钮
   - 表格主体显示对账数据
   - 支持水平滚动查看所有列

### 数据结构
- **对账数据字段**：
  1. `month`: 月份
  2. `expressCompany`: 快递公司
  3. `orderCount`: 订单数量
  4. `totalWeight`: 总重量
  5. `basicFee`: 基础费用
  6. `extraFee`: 额外费用
  7. `totalFee`: 总费用
  8. `settlementStatus`: 结算状态
  9. `settlementDate`: 结算日期
  10. `settlementNumber`: 结算单号

### 数据流转
1. 页面加载时，加载当前月份的对账数据
2. 用户可选择不同月份和筛选条件查看对应数据
3. 统计摘要区域会根据筛选条件更新
4. 用户可导出Excel或生成月度报表

### 注意事项
1. 表格支持水平滚动，确保在小屏幕设备上能查看所有列
2. 默认显示当前月份的数据
3. 导出和报表功能需后端API支持

## 任务动态看板页面(taskBoard.html)

### 页面结构
1. **标题区域**
   - 页面标题："任务动态看板"
   
2. **日期选择区域**
   - 日期选择器
   - 任务类型选择器

3. **任务卡片区域**
   - 待处理任务卡片
   - 进行中任务卡片
   - 已完成任务卡片
   - 已取消任务卡片

4. **任务统计图表区域**
   - 任务完成率图表
   - 任务类型分布图表
   - 员工任务分配图表

### 数据结构
- **任务数据字段**：
  1. `taskId`: 任务ID
  2. `taskType`: 任务类型
  3. `taskName`: 任务名称
  4. `taskDesc`: 任务描述
  5. `startTime`: 开始时间
  6. `deadline`: 截止时间
  7. `assignee`: 负责人
  8. `status`: 状态
  9. `progress`: 进度
  10. `priority`: 优先级

### 数据流转
1. 页面加载时，加载当前日期的任务数据
2. 用户可选择不同日期和任务类型查看对应数据
3. 用户可拖拽任务卡片在不同状态列之间移动
4. 图表和统计数据会随任务变化更新

### 注意事项
1. 页面采用看板设计，直观展示任务状态
2. 任务卡片支持拖拽操作
3. 高优先级任务有醒目标记
4. 已过期任务有警示效果
5. 图表使用Chart.js库绘制，支持交互和提示信息

# 订单列表页面 (orderList.html)

本文档介绍订单列表页面的结构、布局、数据流转和使用方法。

## 页面结构

订单列表页面是物流系统的核心页面，用于展示、筛选和管理所有订单信息。页面包含以下主要区域：

1. **操作按钮区域**：位于页面顶部，包含数据同步、本地存档、快递设置、生成运单、打印运单等功能按钮
2. **筛选区域**：用于按多种条件筛选订单数据
3. **订单表格**：展示订单详细信息的表格
4. **分页控件**：用于在多页订单数据间导航

## 布局结构

```
+--------------------------------------------------+
| 订单发货明细                      [功能按钮区域] |
+--------------------------------------------------+
| [筛选条件区域]                                   |
+--------------------------------------------------+
| [订单表格]                                       |
|                                                  |
|                                                  |
|                                                  |
+--------------------------------------------------+
| [分页控件区域]                                   |
+--------------------------------------------------+
```

### 操作按钮区域

操作按钮区域包含以下按钮：

- **本地存档**：打开本地数据存储功能
- **快递设置**：配置快递100 API参数
- **数据同步**：与维格表进行数据同步
- **生成运单**：为选中订单生成快递运单
- **打印运单**：打印已生成的运单
- **导入**：提供多种订单导入方式

### 筛选区域

筛选区域允许用户根据以下条件筛选订单：

- **日期范围**：按订单日期筛选
- **物流状态**：待发货、已发货、已签收等
- **快递公司**：按所选快递公司筛选
- **关键字搜索**：在订单号、地址、联系人等字段中搜索

### 订单表格

订单表格展示订单的详细信息，每一列都可以点击表头进行排序和筛选，表格列包括：

- 订单时间
- 订单号
- 重量
- 收货地址
- 联系人
- 联系电话
- 快递公司
- 运单号
- 运单模板
- 配送费用
- 发货时间
- 物流状态
- 签收时间
- 是否签收
- 操作

### 分页控件

分页控件允许用户在多页订单数据间导航，包括：

- 页码导航
- 每页显示记录数选择
- 总记录数显示

## 数据结构

订单对象的数据结构如下：

```javascript
{
    orderNumber: "202401010001",    // 订单号
    orderTime: "2024-01-01",        // 订单时间
    weight: "1.5",                  // 重量(kg)
    address: "北京市海淀区...",      // 收货地址
    contact: "张三",                // 联系人
    phone: "13812345678",           // 联系电话
    expressCompany: "顺丰",         // 快递公司
    waybillNumber: "SF1234567890",  // 运单号
    waybillTemplate: "标准模板",     // 运单模板
    shippingFee: "12.00",           // 配送费用
    shippingTime: "2024-01-02",     // 发货时间
    logisticsStatus: {              // 物流状态
        status: "运输中",           // 状态文本
        latestUpdate: "包裹已到达北京转运中心" // 最新物流信息
    },
    receivingTime: "2024-01-05",    // 签收时间
    isSigned: false,                // 是否签收
    lastUpdated: "2024-01-02T10:30:00.000Z" // 最后更新时间
}
```

## 数据流转

订单列表页面的数据流转路径包括：

1. **数据来源**：
   - 本地IndexedDB数据库
   - 维格表数据同步
   - Excel导入
   - API导入

2. **数据处理**：
   - 筛选：根据用户设置的筛选条件过滤数据
   - 排序：根据用户点击的表头排序数据
   - 分页：将数据分成多页显示

3. **数据输出**：
   - 展示：在订单表格中显示处理后的数据
   - 同步：将数据同步到维格表或本地存储
   - 导出：将数据导出为Excel或其他格式

4. **数据更新**：
   - 手动编辑：用户手动编辑订单信息
   - 状态更新：通过快递100 API查询更新物流状态
   - 生成运单：生成运单时更新运单号和物流状态

## 功能描述

### 1. 本地数据存储

通过IndexedDB实现的本地数据存储，提供以下功能：

- 将当前订单数据保存到本地浏览器
- 从本地加载之前保存的订单数据
- 在修改订单状态时自动更新本地存储的数据

### 2. 快递100 API集成

集成快递100 API，提供以下功能：

- 查询物流状态和物流轨迹
- 生成电子面单并获取运单号
- 打印电子面单

### 3. 维格表数据同步

与维格表进行数据同步，提供以下功能：

- 将订单数据上传到维格表
- 从维格表下载最新的订单数据
- 自动映射字段，确保数据格式一致

### 4. 订单管理

提供全面的订单管理功能：

- 按多种条件筛选订单
- 排序和分页显示订单
- 修改订单信息
- 批量操作订单

### 5. 物流管理

提供物流相关功能：

- 选择快递公司
- 生成和打印运单
- 查询物流状态
- 追踪物流轨迹

## 注意事项

1. **数据同步**：
   - 在网络不稳定时，建议先将数据保存到本地
   - 大量数据同步可能需要较长时间，请耐心等待

2. **物流查询**：
   - 顺丰快递查询必须填写手机号后四位
   - 物流状态更新可能存在延迟

3. **电子面单**：
   - 使用电子面单功能需有效的API授权和快递公司合作协议
   - 打印电子面单前请确认打印机设置正确

4. **浏览器兼容性**：
   - 推荐使用Chrome、Firefox或Edge最新版本
   - IE浏览器可能无法正常使用IndexedDB功能

## 相关文件

- `orderList.html`：订单列表页面HTML文件
- `scripts/orderList.js`：订单列表页面JavaScript逻辑
- `styles/order-list.css`：订单列表页面样式
- `services/indexedDBService.js`：IndexedDB本地存储服务
- `services/kuaidi100Service.js`：快递100 API服务
- `services/vikaService.js`：维格表数据同步服务 